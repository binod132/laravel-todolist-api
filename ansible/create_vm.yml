---
- name: Create a new VM from template on ESXi host
  hosts: esxi_host
  gather_facts: yes
  collections:
    - community.vmware
  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    - name: Clone VM from template
      community.vmware.vmware_guest:
        hostname: "{{ ansible_host }}"
        username: root
        password: "{{ ansible_ssh_pass }}"
        validate_certs: no
        name: "new-ansible-vm"
        template: "jump-server"
        state: powered-on
        hardware:
          num_cpus: 2
          memory_mb: 4096
          num_cpu_cores_per_socket: 1
        networks:
          - name: "VM Network"
            type: static
            ip: "192.168.130.12"  # Static IP address
            netmask: "255.255.255.0"  # Subnet mask
            gateway: "192.168.130.1"  # Gateway IP
        disk:
          - size_gb: 50
            type: thin
            datastore: "datastore1"
